<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¼è›‹ - æ¨¡å—åŒ–æ¶æ„ç‰ˆæœ¬</title>

    <!-- å¼•å…¥ä¼˜åŒ–ç‰ˆCSSæ ·å¼ -->
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/game-optimized.css">
    <link rel="stylesheet" href="css/responsive.css">

    <!-- æ¸¸æˆç‰¹å®šæ ·å¼ -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'å¾®è½¯é›…é»‘', Arial, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 25%, #16a085 50%, #27ae60 75%, #2980b9 100%);
            min-height: 100vh;
            color: #fff;
            overflow: hidden;
        }

        .game-table {
            width: calc(100vw - 40px);
            height: calc(100vh - 40px);
            position: relative;
            margin: 20px;
            background: radial-gradient(ellipse at center,
                rgba(39, 174, 96, 0.8) 0%,
                rgba(22, 160, 133, 0.9) 30%,
                rgba(52, 73, 94, 0.95) 60%,
                rgba(44, 62, 80, 1) 100%);
            border: 3px solid #34495e;
            border-radius: 25px;
            box-shadow:
                0 0 30px rgba(52, 73, 94, 0.5),
                inset 0 0 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        /* é¡¶éƒ¨ä¿¡æ¯æ  */
        .top-info-bar {
            position: absolute;
            top: 20px;
            left: 20px;
            transform: none;
            background: linear-gradient(135deg, rgba(52, 73, 94, 0.95) 0%, rgba(44, 62, 80, 0.9) 100%);
            border-radius: 15px;
            padding: 15px 30px;
            display: flex;
            gap: 30px;
            align-items: center;
            z-index: 100;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .info-display {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
            font-weight: bold;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .coin-display {
            color: #f39c12;
            text-shadow: 0 0 10px rgba(243, 156, 18, 0.5);
        }
        .level-display {
            color: #3498db;
            text-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
        }
        .score-display {
            color: #2ecc71;
            text-shadow: 0 0 10px rgba(46, 204, 113, 0.5);
        }

        .settings-btn {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.8) 0%, rgba(41, 128, 185, 0.8) 100%);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 10px 16px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        /* å››äººç©å®¶å¸ƒå±€ - åŸå‹å›¾è¦æ±‚ */
        .player-position {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        /* åŒ—æ–¹ç©å®¶ï¼ˆå¯¹å®¶ï¼‰ - é¡¶éƒ¨ä¸­å¤®ï¼Œä¸å—æ–¹ç©å®¶å¯¹é¢ */
        .player-north {
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
        }

        /* å—æ–¹ç©å®¶ï¼ˆè‡ªå·±ï¼‰ - åº•éƒ¨ä¸­å¤®å®šä½ï¼Œè°ƒæ•´ä¸ºæ¨ªå‘å¸ƒå±€ */
        .player-south {
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex !important;
            flex-direction: row !important;
            align-items: center !important;
            gap: 20px !important;
            width: auto !important;
            max-width: 90vw;
        }

        /* ä¸œæ–¹ç©å®¶ï¼ˆå¯¹æ‰‹ï¼‰ - å³ä¾§ä¸­å¤®ï¼Œè¦†ç›–é€šç”¨æ ·å¼ */
        .player-east {
            right: 80px;
            top: 50%;
            transform: translateY(-50%);
            flex-direction: row !important;
            align-items: center !important;
            gap: 20px !important;
        }

        /* è¥¿æ–¹ç©å®¶ï¼ˆé˜Ÿå‹ï¼‰ - å·¦ä¾§ä¸­å¤®ï¼Œç®€åŒ–å®šä½ */
        .player-west {
            left: 80px;
            top: 50%;
            transform: translateY(-50%);
        }


        /* AIç©å®¶æ‰‹ç‰Œæ˜¾ç¤º - åªæ˜¾ç¤ºä¸€å¼ ç‰ŒèƒŒï¼Œå…¶ä»–å †å åœ¨ä¸‹é¢ */
        .ai-hand-cards {
            position: relative;
            width: 60px;
            height: 84px;
        }

        .ai-card-back {
            position: absolute;
            width: 60px;
            height: 84px;
            background:
                radial-gradient(circle at 25% 25%, #fff 2px, transparent 2px),
                radial-gradient(circle at 75% 25%, #fff 2px, transparent 2px),
                radial-gradient(circle at 25% 75%, #fff 2px, transparent 2px),
                radial-gradient(circle at 75% 75%, #fff 2px, transparent 2px),
                radial-gradient(circle at 50% 50%, #fff 3px, transparent 3px),
                repeating-linear-gradient(45deg,
                    #1e3c72 0px, #1e3c72 3px,
                    #2a5298 3px, #2a5298 6px,
                    #1e3c72 6px, #1e3c72 9px),
                linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #1e3c72 100%);
            background-size: 100% 100%, 100% 100%, 100% 100%, 100% 100%, 100% 100%, 12px 12px, 100% 100%;
            border: 2px solid #d4af37;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #d4af37;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .ai-card-back:nth-child(1) { z-index: 3; }
        .ai-card-back:nth-child(2) { z-index: 2; transform: translate(2px, 2px); }
        .ai-card-back:nth-child(3) { z-index: 1; transform: translate(4px, 4px); }

        /* ç©å®¶æ‰‹ç‰Œæ˜¾ç¤º - ç²¾ç¡®å¯¹è§’å¸ƒå±€ */
        .player-hand-cards {
            display: flex;
            position: relative;
            padding: 20px 10px;
            margin: 0 auto;
            width: fit-content;
            max-width: 900px;
            justify-content: center;
            align-items: flex-end;
        }

        .player-card {
            width: 60px;
            height: 84px;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 50%, #e9ecef 100%);
            border: 2px solid #dee2e6;
            border-radius: 10px;
            cursor: pointer;
            position: relative;
            margin-left: -30px; /* æ›´ç´§å¯†çš„é‡å é—´è· */
            margin-bottom: 0;
            box-shadow:
                0 4px 12px rgba(0, 0, 0, 0.15),
                0 2px 4px rgba(0, 0, 0, 0.1);
            user-select: none;
            overflow: hidden;
            backdrop-filter: blur(5px);
        }

        .player-card:first-child {
            margin-left: 0;
        }

        /* æ‰‹ç‰Œå±‚çº§å…³ç³» - å®ç°è¿ç»­è¦†ç›–æ•ˆæœï¼šå³è¾¹ç‰Œå§‹ç»ˆåœ¨å·¦è¾¹ç‰Œä¸Š */
        .player-card {
            position: relative;
            z-index: auto; /* ä½¿ç”¨åŠ¨æ€z-index */
        }

        /* è¿ç»­è¦†ç›–æ•ˆæœï¼šç´¢å¼•è¶Šå¤§ï¼Œå±‚çº§è¶Šé«˜ */
        .player-card:nth-child(1) { z-index: 10; } /* ç¬¬1å¼ ç‰Œ - æœ€ä½å±‚çº§ */
        .player-card:nth-child(2) { z-index: 20; } /* ç¬¬2å¼ ç‰Œ - å‹ç¬¬1å¼  */
        .player-card:nth-child(3) { z-index: 30; } /* ç¬¬3å¼ ç‰Œ - å‹ç¬¬2å¼  */
        .player-card:nth-child(4) { z-index: 40; } /* ç¬¬4å¼ ç‰Œ - å‹ç¬¬3å¼  */
        .player-card:nth-child(5) { z-index: 50; } /* ç¬¬5å¼ ç‰Œ - å‹ç¬¬4å¼  */
        .player-card:nth-child(6) { z-index: 60; } /* ç¬¬6å¼ ç‰Œ - å‹ç¬¬5å¼  */
        .player-card:nth-child(7) { z-index: 70; } /* ç¬¬7å¼ ç‰Œ - å‹ç¬¬6å¼  */
        .player-card:nth-child(8) { z-index: 80; } /* ç¬¬8å¼ ç‰Œ - å‹ç¬¬7å¼  */

        /* é€šç”¨è§„åˆ™ï¼šç´¢å¼•è¶Šå¤§ï¼Œå±‚çº§è¶Šé«˜ï¼Œå½¢æˆè¿ç»­è¦†ç›– */
        .player-card:nth-child(n) {
            z-index: calc(10 * var(--card-index, 1));
        }

        /* ç§»é™¤æ‰€æœ‰æ‚¬æµ®æ•ˆæœå’ŒåŠ¨ç”» */
        .player-card:hover {
            /* å®Œå…¨ç§»é™¤æ‚¬æµ®æ•ˆæœ */
        }

        .player-card.selected {
            transform: translateY(-12px); /* ä¿ç•™é€‰ä¸­çŠ¶æ€çš„ä½ç§»ï¼Œä¾¿äºè¯†åˆ« */
            border-color: #f39c12;
            border-width: 3px;
            background: linear-gradient(135deg, #fff9e6 0%, #fef5e7 50%, #fdebd0 100%);
        }

        /* ç©å®¶ç‰Œé¢å†…å®¹ - ç²¾ç¡®å¯¹è§’è®¾è®¡ */
        .player-card .card-content {
            position: relative;
            width: 100%;
            height: 100%;
            padding: 4px 3px; /* ç²¾ç¡®å†…è¾¹è· */
            color: inherit;
        }

        .player-card .card-top-left {
            position: absolute;
            top: 3px;
            left: 3px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            line-height: 1;
        }

        .player-card .card-rank-top {
            font-weight: 700;
            font-size: 14px;
            margin-bottom: 1px;
        }

        .player-card .card-suit-top {
            font-size: 18px;
        }

        .player-card .card-bottom-right {
            position: absolute;
            bottom: 3px;
            right: 3px;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            line-height: 1;
            transform: rotate(180deg);
        }

        .player-card .card-rank-bottom {
            font-weight: 700;
            font-size: 14px;
            margin-bottom: 1px;
        }

        .player-card .card-suit-bottom {
            font-size: 18px;
        }

        .player-card.red { color: #DC143C !important; }
        .player-card.black { color: #000 !important; }

        /* å›ºå®šä¿¡æ¯é¢æ¿è®¾è®¡ - ç§»é™¤æ‰€æœ‰åŠ¨ç”»æ•ˆæœ */
        .player-info {
            position: fixed;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 249, 250, 0.9) 100%);
            backdrop-filter: blur(15px);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            padding: 12px 16px;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 180px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* ç§»é™¤ä¿¡æ¯é¢æ¿çš„æ‰€æœ‰é¼ æ ‡äº¤äº’åŠ¨ç”» */
        .player-info:hover {
            /* å®Œå…¨ç§»é™¤æ‚¬æµ®æ•ˆæœ */
        }

        /* ä¸»ç©å®¶å·¦ä¸‹è§’å®šä½ - æ”¾åœ¨æ‰‹ç‰Œå·¦ä¾§ */
        .main-player-info {
            bottom: 16px;
            left: 50%;
            transform: translateX(calc(-50% - 380px));
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.1) 0%, rgba(41, 128, 185, 0.05) 100%);
            border: 2px solid rgba(52, 152, 219, 0.3);
        }

        /* ç¡®ä¿å—æ–¹ç©å®¶ä¿¡æ¯é¢æ¿ä½¿ç”¨è“è‰²æ¸å˜èƒŒæ™¯ - è¦†ç›–ç™½è‰²èƒŒæ™¯ */
        .player-card-info.main-player-info {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.1) 0%, rgba(41, 128, 185, 0.05) 100%) !important;
            border: 2px solid rgba(52, 152, 219, 0.3) !important;
        }

        /* ç»Ÿä¸€ç©å®¶ä¿¡æ¯é¢æ¿æ ·å¼ - ç§»é™¤æ‰€æœ‰åŠ¨ç”»æ•ˆæœ */
        .player-card-info,
        .player-info.ai-player-info {
            position: fixed;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 249, 250, 0.9) 100%);
            backdrop-filter: blur(15px);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
            min-width: 200px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            z-index: 100;
        }

        /* ç§»é™¤æ‰€æœ‰ä¿¡æ¯é¢æ¿çš„é¼ æ ‡äº¤äº’åŠ¨ç”» */
        .player-card-info:hover,
        .player-info.ai-player-info:hover {
            /* å®Œå…¨ç§»é™¤æ‚¬æµ®æ•ˆæœ */
        }

        /* AIç©å®¶ç‰¹æ®Šè°ƒæ•´ - ä½¿ç”¨ç»å¯¹å®šä½ï¼Œä½†ä¿æŒå®Œå…¨ç›¸åŒçš„æ ·å¼ */
        .player-info.ai-player-info {
            position: absolute;
        }

        /* å¤´åƒæ ·å¼ - ç»Ÿä¸€48pxå°ºå¯¸ */
        .player-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3498db 0%, #2980b9 50%, #1abc9c 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            box-shadow: 0 6px 16px rgba(52, 152, 219, 0.4);
            border: 3px solid rgba(255, 255, 255, 0.4);
            flex-shrink: 0;
        }

        .main-player-info .player-avatar {
            width: 48px;
            height: 48px;
            font-size: 24px;
            background: linear-gradient(135deg, #3498db 0%, #2980b9 50%, #1abc9c 100%);
            box-shadow: 0 6px 16px rgba(52, 152, 219, 0.4);
            border: 3px solid rgba(255, 255, 255, 0.4);
        }

        /* ç©å®¶è¯¦æƒ… */
        .player-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .player-name-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .player-name {
            font-size: 18px;
            font-weight: 600;
            color: #FFD700;
        }

        .main-player-info .player-name {
            font-size: 18px;
            color: #FFD700;
            font-weight: 600;
        }

        /* é˜Ÿå‹å¯¹æ‰‹åŒºåˆ†å›¾æ ‡ */
        .team-indicator {
            font-size: 16px;
            margin-left: 4px;
        }

        .teammate-indicator {
            color: #27ae60;
        }

        .opponent-indicator {
            color: #e74c3c;
        }

        /* ç©å®¶çŠ¶æ€ */
        .player-status {
            font-size: 12px;
            color: #7f8c8d;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .card-count-info {
            font-size: 12px;
            color: #95a5a6;
            background: rgba(52, 73, 94, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            display: inline-block;
        }

        /* æŠ¥ç‰Œæç¤ºå¾½ç«  - ç§»é™¤åŠ¨ç”» */
        .announcement-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #e74c3c;
            color: white;
            font-size: 10px;
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* ç§»é™¤æ—§çš„player-infoæ ·å¼é¿å…å†²çªï¼Œä½†ä¸å½±å“ai-player-info */
        .player-position > .player-info:not(.ai-player-info) {
            display: none;
        }


        /* æŠ¥ç‰ŒåŠŸèƒ½æ ·å¼ - ç§»é™¤åŠ¨ç”» */
        .card-announcement {
            position: absolute;
            background: rgba(231, 76, 60, 0.95);
            color: white;
            font-size: 12px;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(231, 76, 60, 0.4);
            z-index: 101;
            white-space: nowrap;
        }

        /* é¡¶éƒ¨å›¢é˜Ÿä¿¡æ¯æ  */
        .team-info-bar {
            position: absolute;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, rgba(52, 73, 94, 0.95) 0%, rgba(44, 62, 80, 0.9) 100%);
            border-radius: 15px;
            padding: 12px 20px;
            display: flex;
            gap: 30px;
            align-items: center;
            z-index: 99;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(8px);
        }

        .team-info-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .team-label {
            font-size: 11px;
            color: #bdc3c7;
            font-weight: 500;
        }

        .team-value {
            font-size: 14px;
            font-weight: bold;
            color: #fff;
        }

        .team-a { color: #3498db; }
        .team-b { color: #e74c3c; }

        /* ä¸­å¤®å‡ºç‰ŒåŒºåŸŸ - å—æ–¹ç©å®¶è§†è§’ */
        .central-play-area {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            height: 300px;
            background: linear-gradient(135deg,
                rgba(46, 204, 113, 0.1) 0%,
                rgba(39, 174, 96, 0.15) 30%,
                rgba(52, 73, 94, 0.2) 70%,
                rgba(44, 62, 80, 0.25) 100%);
            border: 3px solid rgba(46, 204, 113, 0.3);
            border-radius: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
            padding: 20px;
            overflow: hidden;
            box-shadow:
                0 0 30px rgba(46, 204, 113, 0.2),
                inset 0 0 20px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        /* å‡ºç‰Œç»„å¸ƒå±€ - æ¨¡æ‹Ÿç‰Œæ¡Œæ–¹ä½ */
        .plays-group {
            display: block; /* æ”¹ä¸ºblockï¼Œé¿å…flexå¹²æ‰°å †å  */
            min-height: 60px;
            width: 100%;
            padding: 0 10px; /* æ·»åŠ å†…è¾¹è· */
            position: relative; /* ä¸ºå­å…ƒç´ å®šä½æä¾›å‚è€ƒ */
            text-align: left; /* å·¦å¯¹é½ */
        }

        .north-plays {
            align-self: center;
            margin-bottom: 10px;
        }

        .south-plays {
            align-self: center;
            margin-top: 10px;
        }

        .middle-row {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            max-width: 280px;
        }

        .west-plays {
            margin-right: 30px;
        }

        .east-plays {
            margin-left: 30px;
        }

        /* å‡ºç‰Œå †å æ•ˆæœ - æ‰€æœ‰ç‰Œæ­£å‘å—æ–¹ç©å®¶ */
        .plays-group > .player-card {
            margin-left: -35px !important; /* å¼ºåˆ¶ä½¿ç”¨ä¸æ‰‹ç‰ŒåŒºåŸŸå®Œå…¨ç›¸åŒçš„é‡å åº¦ */
            position: relative;
            transform: scale(0.8); /* ç»Ÿä¸€ç¼©æ”¾ */
            z-index: calc(10 * var(--card-index, 1)); /* ä¸æ‰‹ç‰ŒåŒºåŸŸå®Œå…¨ä¸€è‡´ */
            /* ç¡®ä¿position: relativeç”Ÿæ•ˆ */
            display: block;
        }

        /* å‡ºç‰ŒåŒºåŸŸç¬¬ä¸€å¼ ç‰Œå–æ¶ˆé‡å  */
        .plays-group > .player-card:first-child {
            margin-left: 0 !important;
        }

        /* æœ€æ–°å‡ºç‰Œçªå‡ºæ˜¾ç¤º */
        .latest-group {
            filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.8));
            transform: scale(1.05);
        }

        /* ä¸­å¤®çŠ¶æ€åŒºåŸŸ */
        .status-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            pointer-events: none;
        }

        .control-panel {
            position: absolute;
            right: 20px;
            bottom: 20px;
            background: linear-gradient(135deg, rgba(52, 73, 94, 0.95) 0%, rgba(44, 62, 80, 0.9) 100%);
            border-radius: 15px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            max-width: 300px;
        }

        .control-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            min-width: 70px;
            justify-content: center;
            position: relative;
            overflow: hidden;
            font-family: 'Microsoft YaHei', sans-serif;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ç§»é™¤æ‰€æœ‰æŒ‰é’®åŠ¨ç”»æ•ˆæœ */
        .btn:hover:not(:disabled) {
            /* å®Œå…¨ç§»é™¤æ‚¬æµ®æ•ˆæœ */
        }

        .btn:active:not(:disabled) {
            /* å®Œå…¨ç§»é™¤ç‚¹å‡»æ•ˆæœ */
        }

        .btn-play {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 50%, #16a085 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
        }


        .btn-hint {
            background: linear-gradient(135deg, #3498db 0%, #5dade2 50%, #2980b9 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }


        .btn-pass {
            background: linear-gradient(135deg, #e67e22 0%, #f39c12 50%, #d68910 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(243, 156, 18, 0.3);
        }


        .btn-report {
            background: linear-gradient(135deg, #9b59b6 0%, #af7ac5 50%, #8e44ad 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(155, 89, 182, 0.3);
        }


        .btn-records {
            background: linear-gradient(135deg, #f1c40f 0%, #f4d03f 50%, #d68910 100%);
            color: #2c3e50;
            box-shadow: 0 4px 15px rgba(241, 196, 15, 0.3);
        }


        .btn-restart {
            background: linear-gradient(135deg, #95a5a6 0%, #bdc3c7 50%, #7f8c8d 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(149, 165, 166, 0.3);
        }


        /* ç§»é™¤æ‰€æœ‰åŠ¨ç”»æ•ˆæœ */

        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 50%, #16a085 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            color: white;
            font-family: 'Microsoft YaHei', sans-serif;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 20px;
            margin-bottom: 10px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: #fff;
            width: 0%;
            transition: width 0.3s ease;
        }

        .game-container {
            opacity: 0;
            transition: opacity 1s ease;
        }

        .game-container.loaded {
            opacity: 1;
        }

        /* é”™è¯¯æç¤ºæ ·å¼ */
        .error-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(231, 76, 60, 0.95);
            color: white;
            padding: 20px 30px;
            border-radius: 10px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 10001;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        /* å¼€å‘æ¨¡å¼æ§åˆ¶å° */
        .dev-console {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: #00ff00;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-width: 300px;
            max-height: 150px;
            overflow-y: auto;
            z-index: 9999;
            display: none;
        }

        .dev-console.show {
            display: block;
        }

        /* æ¨¡å—åŒ–ä¿¡æ¯æ˜¾ç¤º */
        .module-info {
            position: fixed;
            top: 80px;
            right: 20px;
            background: rgba(52, 73, 94, 0.9);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
            z-index: 1000;
            max-width: 200px;
        }

        .module-info .module-status {
            margin: 5px 0;
            padding: 3px 6px;
            border-radius: 3px;
        }

        .module-status.loaded {
            background: rgba(46, 204, 113, 0.3);
            color: #2ecc71;
        }

        .module-status.loading {
            background: rgba(241, 196, 15, 0.3);
            color: #f1c40f;
        }

        .module-status.error {
            background: rgba(231, 76, 60, 0.3);
            color: #e74c3c;
        }

        /* å·²è¿‡ç‰Œç©å®¶çš„è§†è§‰æç¤º */
        .player-area.passed {
            opacity: 0.6;
            background: linear-gradient(135deg, rgba(52, 73, 94, 0.3) 0%, rgba(44, 62, 80, 0.3) 100%);
            border: 2px dashed #7f8c8d;
        }

        .player-area.passed::after {
            content: "å·²è¿‡ç‰Œ";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(231, 76, 60, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            z-index: 10;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        /* ç¦ç”¨æŒ‰é’®æ ·å¼ */
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
    </style>
</head>
<body>
    <!-- åŠ è½½ç”»é¢ -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-spinner"></div>
        <div class="loading-text">æ­£åœ¨åŠ è½½æ¼è›‹æ¸¸æˆ...</div>
        <div class="loading-progress">
            <div class="loading-progress-bar" id="loadingProgress"></div>
        </div>
        <div id="loadingStatus">åˆå§‹åŒ–ç»„ä»¶ä¸­...</div>
    </div>

    <!-- é”™è¯¯æ¶ˆæ¯ -->
    <div class="error-message" id="errorMessage">
        <h3>åŠ è½½é”™è¯¯</h3>
        <p id="errorText">æ¸¸æˆç»„ä»¶åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•ã€‚</p>
        <button onclick="location.reload()" class="btn btn-secondary">é‡æ–°åŠ è½½</button>
    </div>

    <!-- æ¸¸æˆä¸»å®¹å™¨ -->
    <div class="game-container" id="gameContainer">
        <div class="game-table">
            <!-- é¡¶éƒ¨ä¿¡æ¯æ  -->
            <div class="top-info-bar">
                <div class="info-display coin-display">
                    <span>ğŸ’°</span>
                    <span id="coins">1000</span>
                </div>
                <div class="info-display level-display">
                    <span>â­</span>
                    <span id="level">åˆçº§</span>
                </div>
                <div class="info-display score-display">
                    <span>ğŸ†</span>
                    <span id="score">1250</span>
                </div>
                <button class="settings-btn" onclick="showSettings()">âš™ï¸ è®¾ç½®</button>
            </div>

            <!-- é¡¶éƒ¨å›¢é˜Ÿä¿¡æ¯æ  -->
            <div class="team-info-bar" style="top: 100px; left: 50%; transform: translateX(-50%);">
                <div class="team-info-item">
                    <div class="team-label">é˜Ÿå‹é˜Ÿ (A)</div>
                    <div class="team-value team-a" id="teamACards">54å¼ </div>
                </div>
                <div class="team-info-item">
                    <div class="team-label">å¯¹æ‰‹é˜Ÿ (B)</div>
                    <div class="team-value team-b" id="teamBCards">54å¼ </div>
                </div>
                <div class="team-info-item">
                    <div class="team-label">å½“å‰çŠ¶æ€</div>
                    <div class="team-value" id="gameStatus">è¿›è¡Œä¸­</div>
                </div>
            </div>

            <!-- åŒ—æ–¹ç©å®¶ï¼ˆå¯¹å®¶ï¼‰ -->
            <div class="player-position player-north">
                <div class="ai-hand-cards" id="northCards">
                    <!-- AIæ‰‹ç‰Œåªæ˜¾ç¤ºç‰ŒèƒŒï¼Œå †å æ•ˆæœ -->
                </div>
                <!-- æ‚¬æµ®ä¿¡æ¯é¢æ¿ -->
                <div class="player-info ai-player-info" style="position: relative; margin-top: 10px;">
                    <div class="player-avatar">ğŸ¤–</div>
                    <div class="player-details">
                        <div class="player-name-row">
                            <div class="player-name">AIç©å®¶2</div>
                            <div class="team-indicator opponent-indicator" title="å¯¹æ‰‹">ğŸ”´</div>
                        </div>
                        <div class="player-status">
                            <span class="card-count-info">å‰©ä½™: <span id="northCount">27</span>å¼ </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è¥¿æ–¹ç©å®¶ï¼ˆé˜Ÿå‹ï¼‰ -->
            <div class="player-position player-west">
                <!-- AIæ‰‹ç‰Œ - åœ¨å·¦è¾¹ -->
                <div class="ai-hand-cards" id="westCards">
                    <!-- AIæ‰‹ç‰Œåªæ˜¾ç¤ºç‰ŒèƒŒï¼Œå †å æ•ˆæœ -->
                </div>
                <!-- æ‚¬æµ®ä¿¡æ¯é¢æ¿ - åœ¨æ‰‹ç‰Œå³è¾¹ -->
                <div class="player-info ai-player-info" style="position: relative; margin-top: 10px;">
                    <div class="player-avatar">ğŸ¯</div>
                    <div class="player-details">
                        <div class="player-name-row">
                            <div class="player-name">AIç©å®¶3</div>
                            <div class="team-indicator teammate-indicator" title="é˜Ÿå‹">ğŸ’š</div>
                        </div>
                        <div class="player-status">
                            <span class="card-count-info">å‰©ä½™: <span id="westCount">27</span>å¼ </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä¸œæ–¹ç©å®¶ï¼ˆå¯¹æ‰‹ï¼‰ -->
            <div class="player-position player-east">
                <!-- æ‚¬æµ®ä¿¡æ¯é¢æ¿ - åœ¨æ‰‹ç‰Œå·¦è¾¹ -->
                <div class="player-info ai-player-info" style="position: relative; margin-right: 10px;">
                    <div class="player-avatar">âš¡</div>
                    <div class="player-details">
                        <div class="player-name-row">
                            <div class="player-name">AIç©å®¶4</div>
                            <div class="team-indicator opponent-indicator" title="å¯¹æ‰‹">ğŸ”´</div>
                        </div>
                        <div class="player-status">
                            <span class="card-count-info">å‰©ä½™: <span id="eastCount">27</span>å¼ </span>
                        </div>
                    </div>
                </div>
                <!-- æ‰‹ç‰Œ - åœ¨å³è¾¹ -->
                <div class="ai-hand-cards" id="eastCards">
                    <!-- AIæ‰‹ç‰Œåªæ˜¾ç¤ºç‰ŒèƒŒï¼Œå †å æ•ˆæœ -->
                </div>
            </div>

            <!-- å—æ–¹ç©å®¶ï¼ˆè‡ªå·±ï¼‰ -->
            <div class="player-position player-south">
                <!-- ä¸»ç©å®¶ä¿¡æ¯é¢æ¿ - æ‰‹ç‰Œå·¦ä¾§ -->
                <div class="player-card-info main-player-info" id="mainPlayerInfo">
                    <div class="player-avatar">ğŸŒŸ</div>
                    <div class="player-details">
                        <div class="player-name-row">
                            <div class="player-name">å—å®¶(ä½ )</div>
                            <div class="team-indicator teammate-indicator" title="é˜Ÿå‹">ğŸ’š</div>
                        </div>
                        <div class="player-status">
                            <span class="card-count-info">æ‰‹ç‰Œ: <span id="southCardCountDisplay">0</span>å¼ </span>
                        </div>
                        <div class="player-status" id="mainPlayerStatus">å‡†å¤‡ä¸­...</div>
                    </div>
                </div>
                <div class="player-hand-cards" id="southCards">
                    <!-- ç©å®¶æ‰‹ç‰Œå †å æ‘†æ”¾ï¼Œå·¦ä¸‹å³ä¸Šæ’åˆ— -->
                </div>
            </div>

            <!-- ä¸­å¤®å‡ºç‰ŒåŒºåŸŸ - å—æ–¹ç©å®¶è§†è§’ -->
            <div class="central-play-area" id="centralPlayArea">
                <!-- åŒ—ä½å‡ºç‰Œç»„ -->
                <div class="plays-group north-plays" id="northPlays"></div>

                <!-- ä¸­ä½å‡ºç‰Œç»„ï¼ˆä¸œè¥¿å¹¶æ’ï¼‰ -->
                <div class="middle-row">
                    <div class="plays-group west-plays" id="westPlays"></div>
                    <div class="plays-group east-plays" id="eastPlays"></div>
                </div>

                <!-- å—ä½å‡ºç‰Œç»„ -->
                <div class="plays-group south-plays" id="southPlays"></div>

                <!-- ä¸­å¤®çŠ¶æ€æ˜¾ç¤º -->
                <div class="play-area-center" id="playAreaCenter">
                    <div id="playAreaStatus">ç­‰å¾…å‡ºç‰Œ...</div>
                </div>
            </div>


            <!-- æ§åˆ¶æŒ‰é’®é¢æ¿ -->
            <div class="control-panel">
                <div class="control-buttons">
                    <button class="btn btn-play" id="playBtn" onclick="playCards()" disabled>
                        ğŸš€ å‡ºç‰Œ
                    </button>
                    <button class="btn btn-hint" id="hintBtn" onclick="showHint()">
                        ğŸ’¡ æç¤º
                    </button>
                    <button class="btn btn-pass" id="passBtn" onclick="passTurn()" disabled>
                        âœ‹ ä¸è¦
                    </button>
                    <button class="btn btn-report" id="reportBtn" onclick="reportCards()">
                        ğŸ“Š æŠ¥ç‰Œ
                    </button>
                    <button class="btn btn-records" id="recordsBtn" onclick="showRecords()">
                        ğŸ† æˆ˜ç»©
                    </button>
                    <button class="btn btn-restart" id="restartBtn" onclick="restartGame()">
                        ğŸ”„ é‡æ–°å¼€å§‹
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- æ¨¡å—åŒ–ä¿¡æ¯æ˜¾ç¤ºï¼ˆå¼€å‘æ¨¡å¼ï¼‰ -->
    <div class="module-info" id="moduleInfo" style="display: none;">
        <h4 style="margin-bottom: 10px;">æ¨¡å—çŠ¶æ€</h4>
        <div class="module-status loading" id="module-game-engine">æ¸¸æˆå¼•æ“</div>
        <div class="module-status loading" id="module-player-manager">ç©å®¶ç®¡ç†</div>
        <div class="module-status loading" id="module-deck-manager">ç‰Œå †ç®¡ç†</div>
        <div class="module-status loading" id="module-ui">æ¸¸æˆç•Œé¢</div>
        <div class="module-status loading" id="module-rule-engine">è§„åˆ™å¼•æ“</div>
        <div class="module-status loading" id="module-ai-player">AIç³»ç»Ÿ</div>
        <div class="module-status loading" id="module-rules">è§„åˆ™é…ç½®</div>
    </div>

    <!-- å¼€å‘æ§åˆ¶å° -->
    <div class="dev-console" id="devConsole"></div>

    <!-- æ¸¸æˆJavaScript -->
    <!-- å¼•å…¥å¤–éƒ¨JavaScriptç»„ä»¶ -->
    <!-- <script src="js/components/RuleEngine.js"></script> --> <!-- ä¸´æ—¶ç¦ç”¨ï¼šä¿®å¤ä¸‰å¸¦ä¸€é—®é¢˜ -->

    <script>
        // æ¸¸æˆçŠ¶æ€ç®¡ç†
        class GuandanGame {
            constructor() {
                this.players = {
                    north: { id: 'player2', name: 'AIç©å®¶2', cards: [], team: 'B', isAI: true },
                    south: { id: 'player1', name: 'ç©å®¶1', cards: [], team: 'A', isAI: false },
                    west: { id: 'player3', name: 'AIç©å®¶3', cards: [], team: 'A', isAI: true },
                    east: { id: 'player4', name: 'AIç©å®¶4', cards: [], team: 'B', isAI: true }
                };

                this.currentPlayer = 'south';
                this.lastPlayer = null;
                this.currentRoundCards = []; // åªä¿ç•™ä¸€è½®å‡ºç‰Œ
                this.selectedCards = [];
                this.gameState = 'waiting';
                this.playHistory = []; // å‡ºç‰Œå†å²è®°å½•

                // ç©å®¶åœ¨æœ¬è½®æ˜¯å¦å·²ç»è¿‡ç‰Œ
                this.playersPassedThisRound = {
                    south: false,
                    west: false,
                    north: false,
                    east: false
                };

                // åˆå§‹åŒ–è§„åˆ™å¼•æ“
                this.rules = new GuandanRules();
                this.lastPlay = null; // ä¸Šå®¶å‡ºç‰Œè®°å½•

                this.initializeGame();
            }

            initializeGame() {
                this.dealCards();
                this.updateUI();
                this.gameState = 'playing';
            }

            dealCards() {
                // åˆ›å»ºç‰Œç»„å¹¶åˆ†å‘
                const deck = this.createDeck();
                const positions = ['north', 'south', 'west', 'east'];
                const cardsPerPlayer = Math.floor(deck.length / 4);

                positions.forEach((pos, index) => {
                    this.players[pos].cards = deck.slice(index * cardsPerPlayer, (index + 1) * cardsPerPlayer);
                });
            }

            createDeck() {
                const suits = ['â™ ', 'â™¥', 'â™¦', 'â™£'];
                const ranks = ['3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A', '2'];
                const deck = [];

                // åˆ›å»ºä¸¤å‰¯ç‰Œï¼ˆæ¼è›‹ä½¿ç”¨ä¸¤å‰¯ç‰Œï¼‰
                for (let deckCount = 0; deckCount < 2; deckCount++) {
                    for (let suit = 0; suit < 4; suit++) {
                        for (let rank = 0; rank < 13; rank++) {
                            deck.push({
                                suit: suits[suit],
                                rank: ranks[rank],
                                value: rank + 3,
                                isRed: suit === 1 || suit === 2
                            });
                        }
                    }
                }

                // æ·»åŠ å¤§å°ç‹ï¼ˆä¸¤å‰¯ç‰Œå„2å¼ ï¼Œå…±4å¼ ç‹ç‰Œï¼‰
                deck.push({ suit: 'JOKER', rank: 'å°ç‹', value: 16, isRed: true });
                deck.push({ suit: 'JOKER', rank: 'å°ç‹', value: 16, isRed: true });
                deck.push({ suit: 'JOKER', rank: 'å¤§ç‹', value: 17, isRed: true });
                deck.push({ suit: 'JOKER', rank: 'å¤§ç‹', value: 17, isRed: true });

                return this.shuffleArray(deck); // æ€»å…±108å¼ ç‰Œ
            }

            shuffleArray(array) {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            }

            updateUI() {
                this.updatePlayerCards();
                this.updatePlayArea();
                this.updateInfoBars();
                this.updateControlButtons();

                // æ›´æ–°ç©å®¶è¿‡ç‰ŒçŠ¶æ€çš„è§†è§‰åé¦ˆ - æ–°å¢
                this.updatePlayerPassStatus();
            }

            // æ–°å¢å‡½æ•°ï¼šæ›´æ–°ç©å®¶è¿‡ç‰ŒçŠ¶æ€çš„è§†è§‰åé¦ˆ
            updatePlayerPassStatus() {
                const positions = ['south', 'west', 'north', 'east'];
                positions.forEach(pos => {
                    // æ‰¾åˆ°ç©å®¶åŒºåŸŸå…ƒç´ 
                    let playerArea = null;

                    // æ ¹æ®ä½ç½®æŸ¥æ‰¾å¯¹åº”çš„å…ƒç´ 
                    if (pos === 'south') {
                        playerArea = document.querySelector('.player-south');
                    } else if (pos === 'west') {
                        playerArea = document.querySelector('.player-west');
                    } else if (pos === 'north') {
                        playerArea = document.querySelector('.player-north');
                    } else if (pos === 'east') {
                        playerArea = document.querySelector('.player-east');
                    }

                    if (playerArea) {
                        if (this.playersPassedThisRound[pos]) {
                            playerArea.classList.add('passed');
                        } else {
                            playerArea.classList.remove('passed');
                        }
                    }
                });
            }

            updatePlayerCards() {
                // æ›´æ–°AIç©å®¶æ‰‹ç‰Œæ˜¾ç¤ºï¼ˆæ˜¾ç¤ºç‰ŒèƒŒï¼Œæ•°é‡åæ˜ çœŸå®æ‰‹ç‰Œæ•°ï¼‰
                ['north', 'west', 'east'].forEach(pos => {
                    const cardCount = this.players[pos].cards.length;
                    const container = document.getElementById(pos + 'Cards');
                    container.innerHTML = '';

                    // æ˜¾ç¤ºç‰ŒèƒŒï¼Œæ•°é‡ä¸å®é™…æ‰‹ç‰Œæ•°å¯¹åº”ï¼ˆæœ€å¤šæ˜¾ç¤º12å¼ é¿å…ç•Œé¢æ‹¥æŒ¤ï¼‰
                    const displayCount = Math.min(cardCount, 12);
                    for (let i = 0; i < displayCount; i++) {
                        const cardElement = document.createElement('div');
                        cardElement.className = 'ai-card-back';
                        cardElement.innerHTML = 'ğŸ‚ ';

                        // æ·»åŠ å †å æ•ˆæœï¼Œæ¨¡æ‹ŸçœŸå®æ‰‹ç‰Œ
                        if (cardCount > 8) {
                            cardElement.style.transform = `translateX(${i * 2}px) translateY(${i * 0.5}px)`;
                        }

                        container.appendChild(cardElement);
                    }

                    // å¦‚æœç‰Œæ•°è¶…è¿‡æ˜¾ç¤ºæ•°é‡ï¼Œæ·»åŠ æ•°å­—æŒ‡ç¤º
                    if (cardCount > displayCount) {
                        const moreIndicator = document.createElement('div');
                        moreIndicator.className = 'card-count-indicator';
                        moreIndicator.innerHTML = `+${cardCount - displayCount}`;
                        moreIndicator.style.cssText = `
                            position: absolute;
                            right: -10px;
                            bottom: -5px;
                            background: #e74c3c;
                            color: white;
                            border-radius: 50%;
                            width: 20px;
                            height: 20px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-size: 10px;
                            font-weight: bold;
                        `;
                        container.style.position = 'relative';
                        container.appendChild(moreIndicator);
                    }

                    // æ›´æ–°AIç©å®¶ç‰Œæ•°æ˜¾ç¤º
                    const countElement = document.getElementById(pos + 'Count');
                    if (countElement) {
                        countElement.textContent = cardCount;
                    }
                });

                // æ›´æ–°ç©å®¶æ‰‹ç‰Œæ˜¾ç¤ºï¼ˆå †å æ‘†æ”¾ï¼‰
                const southCards = this.players.south.cards;
                const southContainer = document.getElementById('southCards');
                southContainer.innerHTML = '';

                southCards.forEach((card, index) => {
                    const cardElement = document.createElement('div');
                    cardElement.className = `player-card ${card.isRed ? 'red' : 'black'}`;
                    cardElement.innerHTML = `
                        <div class="card-content">
                            <div class="card-top-left">
                                <div class="card-rank-top">${card.rank}</div>
                                <div class="card-suit-top">${card.suit}</div>
                            </div>
                            <div class="card-bottom-right">
                                <div class="card-rank-bottom">${card.rank}</div>
                                <div class="card-suit-bottom">${card.suit}</div>
                            </div>
                        </div>
                    `;
                    // å®ç°è¿ç»­è¦†ç›–æ•ˆæœï¼šå³è¾¹çš„ç‰Œå§‹ç»ˆåœ¨å·¦è¾¹çš„ç‰Œä¸Š
                    // ç´¢å¼•è¶Šå¤§ï¼Œå±‚çº§è¶Šé«˜ï¼Œå½¢æˆ1è¢«2å‹ï¼Œ2è¢«3å‹ï¼Œ3è¢«4å‹çš„è¿ç»­è¦†ç›–
                    cardElement.style.setProperty('--card-index', index + 1); // ä¸å‡ºç‰ŒåŒºåŸŸä¿æŒä¸€è‡´ï¼Œä»1å¼€å§‹
                    cardElement.onclick = () => this.selectCard(card, cardElement);
                    southContainer.appendChild(cardElement);
                });

                // æ›´æ–°å—æ–¹ç©å®¶å‰©ä½™ç‰Œæ•°ï¼ˆå¦‚æœå…ƒç´ å­˜åœ¨ï¼‰
                const southCountElement = document.getElementById('southCardCountDisplay');
                if (southCountElement) {
                    southCountElement.textContent = southCards.length;
                }
            }

            updatePlayArea() {
                // æ¸…ç©ºä¸­å¤®åŒºåŸŸ
                ['northPlays', 'southPlays', 'westPlays', 'eastPlays'].forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.innerHTML = '';
                        element.classList.remove('latest-group');
                    }
                });

                // æ›´æ–°ä¸­å¤®çŠ¶æ€
                const centerArea = document.getElementById('playAreaCenter');
                const statusElement = document.getElementById('playAreaStatus');

                if (this.currentRoundCards.length === 0) {
                    centerArea.innerHTML = '<div id="playAreaStatus">ç­‰å¾…å‡ºç‰Œ...</div>';
                    centerArea.style.display = 'block';
                    return;
                }

                // éšè—ä¸­å¤®çŠ¶æ€
                centerArea.style.display = 'none';

                // æŒ‰å‡ºç‰Œä½ç½®åˆ†é…åˆ°ä¸­å¤®åŒºåŸŸçš„å„ä½ç½®
                this.currentRoundCards.forEach((play, index) => {
                    if (play.cards.length === 0 || play.action === 'pass') {
                        return; // è·³è¿‡passæ“ä½œ
                    }

                    const positionElement = document.getElementById(play.player + 'Plays');
                    if (!positionElement) return;

                    // åˆ›å»ºå‡ºç‰Œç‰Œç»„ï¼ˆç›´æ¥åˆ›å»ºç‰Œå…ƒç´ ï¼Œä¸ä½¿ç”¨é¢å¤–çš„stack divï¼‰
                    // æœ€æ–°å‡ºç‰Œçªå‡ºæ˜¾ç¤º
                    if (index === this.currentRoundCards.length - 1) {
                        positionElement.classList.add('latest-group');
                    }

                    // åˆ›å»ºç‰Œå…ƒç´ ï¼ˆæ‰€æœ‰ç‰Œæ­£å‘å—æ–¹ç©å®¶ï¼‰
                    play.cards.forEach((card, cardIndex) => {
                        const cardElement = document.createElement('div');
                        cardElement.className = `player-card ${card.isRed ? 'red' : 'black'}`;
                        cardElement.innerHTML = `
                            <div class="card-content">
                                <div class="card-top-left">
                                    <div class="card-rank-top">${card.rank}</div>
                                    <div class="card-suit-top">${card.suit}</div>
                                </div>
                                <div class="card-bottom-right">
                                    <div class="card-rank-bottom">${card.rank}</div>
                                    <div class="card-suit-bottom">${card.suit}</div>
                                </div>
                            </div>
                        `;
                        // å…³é”®ï¼šç»Ÿä¸€ä½¿ç”¨ä¸æ‰‹ç‰ŒåŒºåŸŸå®Œå…¨ç›¸åŒçš„z-indexæœºåˆ¶
                        // margin-leftç”±CSSç»Ÿä¸€æ§åˆ¶ï¼Œä¸å†é€šè¿‡JavaScriptè®¾ç½®
                        cardElement.style.setProperty('--card-index', cardIndex + 1); // ä¸æ‰‹ç‰ŒåŒºåŸŸä¿æŒä¸€è‡´ï¼Œä»1å¼€å§‹
                        positionElement.appendChild(cardElement);
                    });
                });
            }

            updateInfoBars() {
                // æ›´æ–°æ¸¸æˆçŠ¶æ€
                const statusElement = document.getElementById('gameStatus');
                if (statusElement) {
                    statusElement.textContent = this.gameState === 'playing' ? 'è¿›è¡Œä¸­' : 'ç­‰å¾…';
                }
            }

            updateControlButtons() {
                const isPlayerTurn = this.currentPlayer === 'south' && this.gameState === 'playing';
                const hasPassed = this.playersPassedThisRound.south; // æ–°å¢

                // ä¸»è¦æ¸¸æˆæŒ‰é’®ï¼ˆéœ€è¦ç©å®¶å›åˆä¸”æœªè¿‡ç‰Œï¼‰
                document.getElementById('playBtn').disabled = !isPlayerTurn || this.selectedCards.length === 0 || hasPassed;
                document.getElementById('passBtn').disabled = !isPlayerTurn || hasPassed;
                document.getElementById('hintBtn').disabled = !isPlayerTurn || hasPassed;

                // æŠ¥ç‰ŒæŒ‰é’®ï¼ˆéœ€è¦ç©å®¶å›åˆï¼‰
                document.getElementById('reportBtn').disabled = !isPlayerTurn;

                // æ·»åŠ æŒ‰é’®çŠ¶æ€è§†è§‰åé¦ˆ
                this.updateButtonVisuals();
            }

            updateButtonVisuals() {
                // ä¸ºæŒ‰é’®æ·»åŠ è§†è§‰çŠ¶æ€åé¦ˆ
                const buttons = ['playBtn', 'passBtn', 'hintBtn', 'reportBtn'];
                buttons.forEach(btnId => {
                    const button = document.getElementById(btnId);
                    if (button) {
                        if (button.disabled) {
                            button.style.filter = 'grayscale(0.5) brightness(0.7)';
                        } else {
                            button.style.filter = 'none';
                        }
                    }
                });
            }

            selectCard(card, element) {
                // æ£€æŸ¥æ˜¯å¦è½®åˆ°ç©å®¶ä¸”æœªè¿‡ç‰Œ - æ–°å¢
                if (this.currentPlayer !== 'south' || this.playersPassedThisRound.south) {
                    return;
                }

                const index = this.selectedCards.findIndex(c => c === card);
                if (index === -1) {
                    this.selectedCards.push(card);
                    element.classList.add('selected');
                } else {
                    this.selectedCards.splice(index, 1);
                    element.classList.remove('selected');
                }

                this.updateControlButtons();
            }

            playCards() {
                if (this.selectedCards.length === 0) return;

                // æ£€æŸ¥ç©å®¶æ˜¯å¦å·²ç»è¿‡ç‰Œ - æ–°å¢
                if (this.playersPassedThisRound[this.currentPlayer]) {
                    alert('ä½ å·²ç»åœ¨æœ¬è½®è¿‡ç‰Œï¼Œä¸èƒ½å†å‡ºç‰Œï¼');
                    return;
                }

                // ä½¿ç”¨è§„åˆ™å¼•æ“éªŒè¯å‡ºç‰Œ
                const validation = this.rules.validatePlay(
                    this.selectedCards,
                    this.lastPlay,
                    this.players.south.cards
                );

                if (!validation.valid) {
                    alert(`å‡ºç‰Œæ— æ•ˆ: ${validation.message}`);
                    return;
                }

                // è®°å½•å‡ºç‰Œç±»å‹
                this.lastPlay = validation.cardType;

                // ç§»é™¤æ‰‹ç‰Œ
                this.selectedCards.forEach(card => {
                    const index = this.players.south.cards.findIndex(c =>
                        c.suit === card.suit && c.rank === card.rank
                    );
                    if (index !== -1) {
                        this.players.south.cards.splice(index, 1);
                    }
                });

                // æ·»åŠ åˆ°å½“å‰è½®æ¬¡ï¼ˆæ¸…é™¤ä¹‹å‰çš„å‡ºç‰Œï¼Œåªä¿ç•™ä¸€è½®ï¼‰
                this.currentRoundCards = [{
                    player: 'south',
                    cards: [...this.selectedCards],
                    cardType: validation.cardType,
                    timestamp: Date.now()
                }];

                this.selectedCards = [];
                this.lastPlayer = 'south';

                // åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªç©å®¶
                this.switchToNextPlayer();
                this.updateUI();

                // AIè‡ªåŠ¨å‡ºç‰Œ
                if (this.gameState === 'playing' && this.players[this.currentPlayer].isAI) {
                    setTimeout(() => this.aiAutoPlay(), 1500);
                }
            }

            passTurn() {
                this.selectedCards = [];

                // è®¾ç½®å½“å‰ç©å®¶è¿‡ç‰ŒçŠ¶æ€ - æ–°å¢
                this.playersPassedThisRound[this.currentPlayer] = true;
                console.log(`[è¿‡ç‰Œ] ${this.currentPlayer} åœ¨æœ¬è½®è¿‡ç‰Œï¼Œå¤±å»å‡ºç‰Œæƒ`);

                // è®°å½•passæ“ä½œ
                this.currentRoundCards.push({
                    player: this.currentPlayer,
                    cards: [],
                    timestamp: Date.now(),
                    action: 'pass'
                });

                // æ£€æŸ¥æ˜¯å¦å¼€å§‹æ–°è½®æ¬¡ï¼ˆè¿ç»­ä¸‰å®¶passæˆ–å›åˆ°èµ·å§‹ç©å®¶ï¼‰
                const shouldStartNewRound = this.checkNewRound();

                this.switchToNextPlayer();

                if (shouldStartNewRound) {
                    // å»¶è¿Ÿæ¸…ç©ºï¼Œè®©ç©å®¶çœ‹åˆ°ç»“æœ
                    setTimeout(() => {
                        this.startNewRound();
                    }, 1000);
                } else {
                    this.updateUI();
                }

                // AIè‡ªåŠ¨å‡ºç‰Œ
                if (this.gameState === 'playing' && this.players[this.currentPlayer].isAI) {
                    setTimeout(() => this.aiAutoPlay(), 1500);
                }
            }

            switchToNextPlayer() {
                const order = ['south', 'west', 'north', 'east'];
                const currentIndex = order.indexOf(this.currentPlayer);
                this.currentPlayer = order[(currentIndex + 1) % 4];
            }

            // æ£€æŸ¥æ˜¯å¦å¼€å§‹æ–°è½®æ¬¡
            checkNewRound() {
                if (this.currentRoundCards.length === 0) return false;

                // è·å–å½“å‰è½®æ¬¡çš„æ‰€æœ‰æ“ä½œ
                const currentRoundPlays = this.currentRoundCards.filter(play => play.action !== 'pass');
                const passActions = this.currentRoundCards.filter(play => play.action === 'pass');

                // æƒ…å†µ1ï¼šè¿ç»­ä¸‰å®¶pass
                if (passActions.length >= 3) {
                    return true;
                }

                // æƒ…å†µ2ï¼šä¸€è½®ç»“æŸï¼ˆå››å®¶éƒ½å‡ºè¿‡ç‰Œï¼Œä¸”æœ€åä¸€å®¶æ˜¯èµ¢å®¶ï¼‰
                const uniquePlayers = new Set(this.currentRoundCards.map(play => play.player));
                if (uniquePlayers.size === 4) {
                    // æ£€æŸ¥æ˜¯å¦å›åˆ°èµ·å§‹ç©å®¶æˆ–æœ€åå‡ºç‰Œè€…
                    const lastPlay = this.currentRoundCards[this.currentRoundCards.length - 1];
                    if (lastPlay.cards.length > 0) {
                        return true;
                    }
                }

                // æƒ…å†µ3ï¼šå½“å‰è½®æ¬¡æœ‰æœ‰æ•ˆå‡ºç‰Œï¼Œä¸”è½®åˆ°èµ·å§‹ç©å®¶
                if (currentRoundPlays.length > 0 && this.currentPlayer === 'south') {
                    return true;
                }

                return false;
            }

            aiAutoPlay() {
                if (this.gameState !== 'playing') return;

                const aiPlayer = this.players[this.currentPlayer];

                // æ£€æŸ¥AIæ˜¯å¦å·²ç»è¿‡ç‰Œ - æ–°å¢
                if (this.playersPassedThisRound[this.currentPlayer]) {
                    console.log(`[AIè¿‡ç‰Œ] ${this.currentPlayer} å·²è¿‡ç‰Œï¼Œè·³è¿‡å‡ºç‰Œ`);
                    this.switchToNextPlayer();
                    this.updateUI();

                    // æ£€æŸ¥æ˜¯å¦å¼€å§‹æ–°è½®æ¬¡
                    const shouldStartNewRound = this.checkNewRound();
                    if (shouldStartNewRound) {
                        setTimeout(() => {
                            this.startNewRound();
                        }, 1000);
                    }

                    // å¦‚æœä¸‹ä¸€ä¸ªæ˜¯AIä¸”æ¸¸æˆç»§ç»­ï¼Œè®©AIå‡ºç‰Œ
                    if (this.gameState === 'playing' && this.players[this.currentPlayer].isAI) {
                        setTimeout(() => this.aiAutoPlay(), 1500);
                    }
                    return;
                }

                try {
                    // æ™ºèƒ½AIé€»è¾‘ï¼šä½¿ç”¨è§„åˆ™å¼•æ“æ‰¾åˆ°æœ€ä½³å‡ºç‰Œ
                    const bestPlay = this.findBestAIPlay(aiPlayer, this.lastPlay);

                    if (bestPlay) {
                        // è®°å½•å‡ºç‰Œç±»å‹
                        this.lastPlay = bestPlay.cards;

                        // ç§»é™¤AIæ‰‹ç‰Œ
                        bestPlay.cards.forEach(card => {
                            const index = aiPlayer.cards.findIndex(c =>
                                c.suit === card.suit && c.rank === card.rank
                            );
                            if (index !== -1) {
                                aiPlayer.cards.splice(index, 1);
                            }
                        });

                        // æ·»åŠ åˆ°å½“å‰è½®æ¬¡
                        this.currentRoundCards.push({
                            player: this.currentPlayer,
                            cards: bestPlay.cards,
                            cardType: bestPlay.type,
                            timestamp: Date.now()
                        });

                        console.log(`[AIå‡ºç‰Œ] ${this.currentPlayer}: å‡º ${bestPlay.type} (${bestPlay.cards.length}å¼ ç‰Œ)`);
                    } else {
                        // AIé€‰æ‹©ä¸è¦ - è®¾ç½®è¿‡ç‰ŒçŠ¶æ€
                        this.playersPassedThisRound[this.currentPlayer] = true;
                        console.log(`[AIè¿‡ç‰Œ] ${this.currentPlayer}: ä¸è¦ï¼Œåœ¨æœ¬è½®å¤±å»å‡ºç‰Œæƒ`);

                        this.currentRoundCards.push({
                            player: this.currentPlayer,
                            cards: [],
                            timestamp: Date.now(),
                            action: 'pass'
                        });
                    }
                } catch (error) {
                    console.error(`[AIé”™è¯¯] ${error.message}`);
                    // å‡ºé”™æ—¶é€‰æ‹©ä¸è¦ - è®¾ç½®è¿‡ç‰ŒçŠ¶æ€
                    this.playersPassedThisRound[this.currentPlayer] = true;
                    this.currentRoundCards.push({
                        player: this.currentPlayer,
                        cards: [],
                        timestamp: Date.now(),
                        action: 'pass'
                    });
                }

                this.switchToNextPlayer();
                this.updateUI();

                // æ£€æŸ¥æ˜¯å¦å¼€å§‹æ–°è½®æ¬¡
                const shouldStartNewRound = this.checkNewRound();
                if (shouldStartNewRound) {
                    setTimeout(() => {
                        this.startNewRound();
                    }, 1000);
                }

                // å¦‚æœä¸‹ä¸€ä¸ªæ˜¯AIä¸”æ¸¸æˆç»§ç»­ï¼Œè®©AIå‡ºç‰Œï¼ˆä½†é¿å…è¿ç»­å¤šä¸ªAIåŒæ—¶å‡ºç‰Œï¼‰
                if (this.gameState === 'playing' && this.players[this.currentPlayer].isAI) {
                    setTimeout(() => this.aiAutoPlay(), 1500);
                }
            }

            // å¯»æ‰¾AIæœ€ä½³å‡ºç‰Œ
            findBestAIPlay(aiPlayer, lastPlay) {
                const handCards = [...aiPlayer.cards];

                console.log(`[AIå†³ç­–] ${aiPlayer.name} æ‰‹ç‰Œ: ${handCards.length}å¼ , ä¸Šå®¶å‡ºç‰Œ:`, lastPlay);

                // å¦‚æœæ²¡æœ‰ä¸Šå®¶å‡ºç‰Œï¼Œå¯ä»¥å‡ºä»»æ„ç‰Œ
                if (!lastPlay || lastPlay.length === 0) {
                    console.log('[AIå†³ç­–] æ–°è½®æ¬¡æˆ–é¦–å®¶ï¼Œå¯»æ‰¾æœ€å°å‡ºç‰Œ');
                    const result = this.findMinimumPlay(handCards);
                    console.log('[AIå†³ç­–] æœ€å°å‡ºç‰Œç»“æœ:', result);
                    return result;
                }

                // å¯»æ‰¾èƒ½æ‰“è¿‡ä¸Šå®¶çš„æœ€å°ç‰Œå‹
                console.log('[AIå†³ç­–] å¯»æ‰¾èƒ½æ‰“è¿‡ä¸Šå®¶çš„ç‰Œå‹');
                const result = this.findBeatingPlay(handCards, lastPlay);
                console.log('[AIå†³ç­–] å‡»è´¥ä¸Šå®¶ç»“æœ:', result);
                return result;
            }

            // å¯»æ‰¾æœ€å°å‡ºç‰Œï¼ˆé¦–è½®æˆ–æ–°è½®æ¬¡ï¼‰
            findMinimumPlay(handCards) {
                console.log('[AIæœ€å°å‡ºç‰Œ] å¼€å§‹å¯»æ‰¾æœ€å°å‡ºç‰Œï¼Œæ‰‹ç‰Œ:', handCards.length, 'å¼ ');

                // ä¼˜å…ˆå‡ºå•å¼ æœ€å°ç‰Œ
                const sortedCards = this.sortCardsByValue(handCards);
                console.log('[AIæœ€å°å‡ºç‰Œ] æ’åºåæ‰‹ç‰Œ:', sortedCards.map(c => `${c.suit}${c.rank}`));

                if (sortedCards.length === 0) {
                    console.log('[AIæœ€å°å‡ºç‰Œ] æ‰‹ç‰Œä¸ºç©ºï¼');
                    return null;
                }

                const singleCard = [sortedCards[0]];
                console.log('[AIæœ€å°å‡ºç‰Œ] å°è¯•å•å¼ :', `${singleCard[0].suit}${singleCard[0].rank}`);

                // éªŒè¯å•å¼ ç‰Œ
                if (this.isValidPlay(singleCard, [])) {
                    console.log('[AIæœ€å°å‡ºç‰Œ] å•å¼ éªŒè¯é€šè¿‡');
                    return {
                        cards: singleCard,
                        type: 'single'
                    };
                } else {
                    console.log('[AIæœ€å°å‡ºç‰Œ] å•å¼ éªŒè¯å¤±è´¥');
                }

                // å¦‚æœå•å¼ ä¸è¡Œï¼Œå°è¯•å¯¹å­
                console.log('[AIæœ€å°å‡ºç‰Œ] å°è¯•å¯»æ‰¾å¯¹å­');
                const pairs = this.findPairs(handCards);
                console.log('[AIæœ€å°å‡ºç‰Œ] æ‰¾åˆ°å¯¹å­æ•°é‡:', pairs.length);
                if (pairs.length > 0) {
                    console.log('[AIæœ€å°å‡ºç‰Œ] ä½¿ç”¨ç¬¬ä¸€ä¸ªå¯¹å­');
                    return {
                        cards: pairs[0],
                        type: 'pair'
                    };
                }

                // å°è¯•ä¸‰å¼ 
                console.log('[AIæœ€å°å‡ºç‰Œ] å°è¯•å¯»æ‰¾ä¸‰å¼ ');
                const triples = this.findTriples(handCards);
                console.log('[AIæœ€å°å‡ºç‰Œ] æ‰¾åˆ°ä¸‰å¼ æ•°é‡:', triples.length);
                if (triples.length > 0) {
                    console.log('[AIæœ€å°å‡ºç‰Œ] ä½¿ç”¨ç¬¬ä¸€ä¸ªä¸‰å¼ ');
                    return {
                        cards: triples[0],
                        type: 'triple'
                    };
                }

                // æœ€åå°è¯•å°é¡ºå­
                console.log('[AIæœ€å°å‡ºç‰Œ] å°è¯•å¯»æ‰¾é¡ºå­');
                const straights = this.findStraights(handCards);
                console.log('[AIæœ€å°å‡ºç‰Œ] æ‰¾åˆ°é¡ºå­æ•°é‡:', straights.length);
                if (straights.length > 0) {
                    console.log('[AIæœ€å°å‡ºç‰Œ] ä½¿ç”¨ç¬¬ä¸€ä¸ªé¡ºå­');
                    return straights[0];
                }

                console.log('[AIæœ€å°å‡ºç‰Œ] æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœ‰æ•ˆå‡ºç‰Œï¼');
                return null;
            }

            // å¯»æ‰¾èƒ½æ‰“è¿‡ä¸Šå®¶çš„å‡ºç‰Œ
            findBeatingPlay(handCards, lastPlay) {
                console.log('[AIå‡»è´¥é€»è¾‘] å¼€å§‹å¯»æ‰¾å‡»è´¥ä¸Šå®¶çš„ç‰Œå‹');
                console.log('[AIå‡»è´¥é€»è¾‘] ä¸Šå®¶å‡ºç‰Œ:', lastPlay);
                console.log('[AIå‡»è´¥é€»è¾‘] æ‰‹ç‰Œæ•°é‡:', handCards.length);

                const sortedCards = this.sortCardsByValue(handCards);
                console.log('[AIå‡»è´¥é€»è¾‘] æ’åºåæ‰‹ç‰Œå‰5å¼ :', sortedCards.slice(0, 5).map(c => `${c.suit}${c.rank}`));

                // æ£€æŸ¥ä¸Šå®¶æ˜¯å¦ä¸ºç‚¸å¼¹
                const isLastPlayBomb = this.isBomb(lastPlay);
                console.log('[AIå‡»è´¥é€»è¾‘] ä¸Šå®¶æ˜¯å¦ä¸ºç‚¸å¼¹:', isLastPlayBomb);

                // å°è¯•ç›¸åŒç‰Œå‹çš„å‡ºç‰Œ
                console.log('[AIå‡»è´¥é€»è¾‘] å°è¯•ç›¸åŒç‰Œå‹å‡ºç‰Œ');
                const sameTypePlays = this.findSameTypePlays(sortedCards, lastPlay);
                console.log('[AIå‡»è´¥é€»è¾‘] ç›¸åŒç‰Œå‹æ‰¾åˆ°:', sameTypePlays.length, 'ä¸ª');
                if (sameTypePlays.length > 0) {
                    console.log('[AIå‡»è´¥é€»è¾‘] è¿”å›ç›¸åŒç‰Œå‹å‡»è´¥');
                    return sameTypePlays[0];
                }

                // å°è¯•ä½¿ç”¨ç‚¸å¼¹
                console.log('[AIå‡»è´¥é€»è¾‘] å°è¯•å¯»æ‰¾ç‚¸å¼¹');
                const bombs = this.findBombs(sortedCards);
                console.log('[AIå‡»è´¥é€»è¾‘] æ‰¾åˆ°ç‚¸å¼¹æ•°é‡:', bombs.length);
                if (bombs.length > 0) {
                    if (!isLastPlayBomb) {
                        console.log('[AIå‡»è´¥é€»è¾‘] ä¸Šå®¶ä¸æ˜¯ç‚¸å¼¹ï¼Œä½¿ç”¨æœ€å°ç‚¸å¼¹');
                        return bombs[0];
                    } else {
                        console.log('[AIå‡»è´¥é€»è¾‘] ä¸Šå®¶æ˜¯ç‚¸å¼¹ï¼Œéœ€è¦æ›´å¤§çš„ç‚¸å¼¹');
                        // æ‰¾åˆ°æ¯”ä¸Šå®¶æ›´å¤§çš„ç‚¸å¼¹
                        const biggerBombs = bombs.filter(bomb => {
                            const bombPower = this.getCardPower(bomb.cards);
                            const lastPlayPower = this.getCardPower(lastPlay);
                            return bombPower > lastPlayPower;
                        });
                        console.log('[AIå‡»è´¥é€»è¾‘] æ‰¾åˆ°æ›´å¤§ç‚¸å¼¹æ•°é‡:', biggerBombs.length);
                        if (biggerBombs.length > 0) {
                            console.log('[AIå‡»è´¥é€»è¾‘] è¿”å›æ›´å¤§çš„ç‚¸å¼¹');
                            return biggerBombs[0];
                        }
                    }
                }

                console.log('[AIå‡»è´¥é€»è¾‘] æ— æ³•æ‰¾åˆ°å‡»è´¥ä¸Šå®¶çš„ç‰Œå‹');
                return null;
            }

            // è¾…åŠ©æ–¹æ³•ï¼šæŒ‰ç‰Œå€¼æ’åº
            sortCardsByValue(cards) {
                return [...cards].sort((a, b) => a.value - b.value);
            }

            // éªŒè¯å‡ºç‰Œæ˜¯å¦æœ‰æ•ˆ
            isValidPlay(cards, lastPlay) {
                try {
                    // ä½¿ç”¨è§„åˆ™å¼•æ“éªŒè¯
                    if (this.rules && this.rules.validatePlay) {
                        const validation = this.rules.validatePlay(cards, lastPlay, cards);
                        return validation.valid;
                    }

                    // ç®€å•éªŒè¯ï¼šè‡³å°‘è¦æœ‰ç‰Œ
                    return cards.length > 0;
                } catch (error) {
                    return false;
                }
            }

            // æŸ¥æ‰¾å¯¹å­
            findPairs(cards) {
                const pairs = [];
                const cardMap = {};

                cards.forEach(card => {
                    if (!cardMap[card.rank]) cardMap[card.rank] = [];
                    cardMap[card.rank].push(card);
                });

                Object.values(cardMap).forEach(sameRankCards => {
                    if (sameRankCards.length >= 2) {
                        pairs.push(sameRankCards.slice(0, 2));
                    }
                });

                return pairs;
            }

            // æŸ¥æ‰¾ä¸‰å¼ 
            findTriples(cards) {
                const triples = [];
                const cardMap = {};

                cards.forEach(card => {
                    if (!cardMap[card.rank]) cardMap[card.rank] = [];
                    cardMap[card.rank].push(card);
                });

                Object.values(cardMap).forEach(sameRankCards => {
                    if (sameRankCards.length >= 3) {
                        triples.push(sameRankCards.slice(0, 3));
                    }
                });

                return triples;
            }

            // æŸ¥æ‰¾é¡ºå­ï¼ˆç®€åŒ–ç‰ˆï¼‰
            findStraights(cards) {
                const straights = [];
                // è¿™é‡Œéœ€è¦æ›´å¤æ‚çš„é€»è¾‘æ¥æŸ¥æ‰¾æœ‰æ•ˆé¡ºå­
                // æš‚æ—¶è¿”å›ç©ºæ•°ç»„ï¼Œåç»­å¯ä»¥å®Œå–„
                return straights;
            }

            // æŸ¥æ‰¾ç‚¸å¼¹
            findBombs(cards) {
                const bombs = [];
                const cardMap = {};

                cards.forEach(card => {
                    if (!cardMap[card.rank]) cardMap[card.rank] = [];
                    cardMap[card.rank].push(card);
                });

                Object.values(cardMap).forEach(sameRankCards => {
                    if (sameRankCards.length >= 4) {
                        bombs.push({
                            cards: sameRankCards,
                            type: 'bomb'
                        });
                    }
                });

                return bombs;
            }

            // åˆ¤æ–­æ˜¯å¦ä¸ºç‚¸å¼¹
            isBomb(cards) {
                return cards.length >= 4;
            }

            // è®¡ç®—ç‰Œå‹çš„å¨åŠ›å€¼ï¼ˆç”¨äºæ¯”è¾ƒå¤§å°ï¼‰
            getCardPower(cards) {
                if (!cards || cards.length === 0) return 0;

                // ç›´æ¥å®šä¹‰ç‰Œå€¼æ˜ å°„
                const cardValues = {
                    '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, '10': 10,
                    'J': 11, 'Q': 12, 'K': 13, 'A': 14, '2': 15,
                    'å°ç‹': 16, 'å¤§ç‹': 17
                };

                // åŸºç¡€å¨åŠ›ï¼šæ‰€æœ‰ç‰Œé¢å€¼çš„æ€»å’Œ
                let power = 0;
                cards.forEach(card => {
                    power += cardValues[card.rank] || 0;
                });

                // ç‚¸å¼¹åŠ æˆ
                if (cards.length >= 4 && cards.every(card => card.rank === cards[0].rank)) {
                    power += 400 + (cards.length - 4) * 100; // 4å¼ ç‚¸å¼¹åŸºç¡€400ï¼Œæ¯å¤šä¸€å¼ +100
                }

                // å››ç‹åŠ æˆï¼ˆ4å¼ ç‹ç‰Œï¼‰
                if (cards.length === 4 && cards.every(card => card.suit === 'JOKER')) {
                    power += 1000; // å››ç‹æœ€å¤§
                }

                return power;
            }

            // æŸ¥æ‰¾ç›¸åŒç‰Œå‹çš„å‡ºç‰Œï¼ˆå¢å¼ºç‰ˆï¼‰
            findSameTypePlays(cards, lastPlay) {
                console.log('[AIç›¸åŒç‰Œå‹] å¼€å§‹å¯»æ‰¾ç›¸åŒç‰Œå‹ï¼Œä¸Šå®¶é•¿åº¦:', lastPlay.length);
                const plays = [];

                // æ£€æŸ¥ä¸Šå®¶æ˜¯å¦ä¸ºç‚¸å¼¹
                const isLastPlayBomb = this.isBomb(lastPlay);
                console.log('[AIç›¸åŒç‰Œå‹] ä¸Šå®¶æ˜¯å¦ä¸ºç‚¸å¼¹:', isLastPlayBomb);

                if (isLastPlayBomb) {
                    console.log('[AIç›¸åŒç‰Œå‹] ä¸Šå®¶æ˜¯ç‚¸å¼¹ï¼Œå¯»æ‰¾æ›´å¤§çš„ç‚¸å¼¹');
                    // ä¸Šå®¶æ˜¯ç‚¸å¼¹ï¼Œéœ€è¦æ›´å¤§çš„ç‚¸å¼¹
                    const bombs = this.findBombs(cards);
                    console.log('[AIç›¸åŒç‰Œå‹] æ‰¾åˆ°ç‚¸å¼¹æ•°é‡:', bombs.length);

                    const biggerBombs = bombs.filter(bomb => {
                        const bombPower = this.getCardPower(bomb.cards);
                        const lastPlayPower = this.getCardPower(lastPlay);
                        return bombPower > lastPlayPower;
                    });

                    console.log('[AIç›¸åŒç‰Œå‹] æ‰¾åˆ°æ›´å¤§ç‚¸å¼¹:', biggerBombs.length);
                    return biggerBombs;
                }

                // æ™®é€šç‰Œå‹æ¯”è¾ƒ
                if (lastPlay.length === 1) {
                    console.log('[AIç›¸åŒç‰Œå‹] å•å¼ æ¯”è¾ƒ');
                    // å•å¼ æ¯”è¾ƒ
                    cards.forEach(card => {
                        if (card.value > lastPlay[0].value) {
                            plays.push({
                                cards: [card],
                                type: 'single'
                            });
                        }
                    });
                } else if (lastPlay.length === 2) {
                    console.log('[AIç›¸åŒç‰Œå‹] å¯¹å­æ¯”è¾ƒ');
                    // å¯¹å­æ¯”è¾ƒ
                    const pairs = this.findPairs(cards);
                    pairs.forEach(pair => {
                        if (pair[0].value > lastPlay[0].value) {
                            plays.push({
                                cards: pair,
                                type: 'pair'
                            });
                        }
                    });
                } else if (lastPlay.length === 3) {
                    console.log('[AIç›¸åŒç‰Œå‹] ä¸‰å¼ æ¯”è¾ƒ');
                    // ä¸‰å¼ æ¯”è¾ƒ
                    const triples = this.findTriples(cards);
                    triples.forEach(triple => {
                        if (triple[0].value > lastPlay[0].value) {
                            plays.push({
                                cards: triple,
                                type: 'triple'
                            });
                        }
                    });
                }

                console.log('[AIç›¸åŒç‰Œå‹] æ‰¾åˆ°ç›¸åŒç‰Œå‹:', plays.length, 'ä¸ª');
                return plays;
            }

            showHint() {
                alert('AIæç¤º: å»ºè®®å‡ºå°ç‰Œæˆ–ä¿ç•™ç‚¸å¼¹åˆ°åæœŸ');
            }

            reportCards() {
                alert('æŠ¥ç‰ŒåŠŸèƒ½: æ˜¾ç¤ºå½“å‰æ‰‹ç‰Œç»Ÿè®¡');
            }

            showRecords() {
                alert('æˆ˜ç»©åŠŸèƒ½: æ˜¾ç¤ºå†å²æˆ˜ç»©ç»Ÿè®¡');
            }

            restartGame() {
                if (confirm('ç¡®å®šè¦é‡æ–°å¼€å§‹æ¸¸æˆå—ï¼Ÿ')) {
                    this.initializeGame();
                }
            }

            showSettings() {
                alert('è®¾ç½®åŠŸèƒ½å¼€å‘ä¸­...');
            }

            // å¼€å§‹æ–°ä¸€è½®ï¼ˆæ¸…é™¤ä¹‹å‰çš„å‡ºç‰Œï¼Œå¹¶æ£€æŸ¥AIç»§ç»­ï¼‰
            startNewRound() {
                this.currentRoundCards = [];
                this.lastPlayer = null;
                this.lastPlay = null; // æ¸…ç©ºä¸Šä¸€æ‰‹ç‰Œï¼Œå…è®¸è‡ªç”±å‡ºç‰Œ

                // é‡ç½®æ‰€æœ‰ç©å®¶çš„è¿‡ç‰ŒçŠ¶æ€ - æ–°å¢
                for (let player in this.playersPassedThisRound) {
                    this.playersPassedThisRound[player] = false;
                }
                console.log('[æ–°è½®æ¬¡] é‡ç½®æ‰€æœ‰ç©å®¶è¿‡ç‰ŒçŠ¶æ€');

                this.updatePlayArea();

                // æ–°è½®æ¬¡å¼€å§‹æ—¶ï¼Œå¦‚æœå½“å‰æ˜¯AIç©å®¶ï¼Œç»§ç»­å‡ºç‰Œ
                if (this.gameState === 'playing' && this.players[this.currentPlayer].isAI) {
                    setTimeout(() => this.aiAutoPlay(), 1000);
                }
            }
        }

        // æ¼è›‹è§„åˆ™å¼•æ“ï¼ˆé›†æˆæ–°å®Œå–„çš„RuleEngineï¼‰
        class GuandanRules {
            constructor() {
                this.cardOrder = ['3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A', '2', 'å°ç‹', 'å¤§ç‹'];
                this.currentLevel = 2; // å½“å‰çº§æ•°ï¼Œä»2å¼€å§‹
                this.jokerCard = null; // çº§ç‰Œï¼ˆé€¢äººé…ï¼‰
                this.initializeLevel();

                // ä½¿ç”¨æ–°å®Œå–„çš„è§„åˆ™å¼•æ“ä½œä¸ºåç«¯
                try {
                    // æ£€æŸ¥RuleEngineæ˜¯å¦å¯ç”¨
                    if (typeof RuleEngine !== 'undefined') {
                        this.ruleEngine = new RuleEngine(null);
                        this.ruleEngine.setLevel(this.currentLevel);
                        // ä¸´æ—¶ç¦ç”¨é«˜çº§è§„åˆ™å¼•æ“ï¼Œä½¿ç”¨åŸºç¡€å¼•æ“ - ä¿®å¤ç‹ç‰Œæ¯”è¾ƒé—®é¢˜
                        this.useAdvancedEngine = false;
                        console.log('[è§„åˆ™å¼•æ“] å·²åŠ è½½é«˜çº§è§„åˆ™å¼•æ“ï¼Œä½†ä½¿ç”¨åŸºç¡€å¼•æ“ï¼ˆä¸´æ—¶ä¿®å¤ï¼‰');
                    } else {
                        console.warn('[è§„åˆ™å¼•æ“] RuleEngineç±»æœªå®šä¹‰ï¼Œå°†ä½¿ç”¨åŸºç¡€å¼•æ“');
                        this.useAdvancedEngine = false;
                        this.initializeBasicEngine();
                    }
                } catch (error) {
                    console.warn('[è§„åˆ™å¼•æ“] é«˜çº§å¼•æ“åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨åŸºç¡€å¼•æ“:', error);
                    this.useAdvancedEngine = false;
                    this.initializeBasicEngine();
                }
            }

            // åˆå§‹åŒ–åŸºç¡€å¼•æ“ï¼ˆé™çº§æ–¹æ¡ˆï¼‰
            initializeBasicEngine() {
                console.log('[è§„åˆ™å¼•æ“] ä½¿ç”¨åŸºç¡€è§„åˆ™å¼•æ“');
                // åŸºç¡€å¼•æ“ä¸éœ€è¦é¢å¤–åˆå§‹åŒ–
            }

            // åˆå§‹åŒ–çº§æ•°
            initializeLevel() {
                this.jokerCard = this.currentLevel === 14 ? 'A' : this.currentLevel.toString();
            }

            // è®¾ç½®å½“å‰çº§æ•°
            setCurrentLevel(level) {
                this.currentLevel = level;
                this.jokerCard = level === 14 ? 'A' : level.toString();
            }

            // è·å–ç‰Œçš„æ•°å€¼
            getCardValue(rank) {
                return this.cardOrder.indexOf(rank);
            }

            // è¯†åˆ«ä¸‡èƒ½ç‰Œï¼ˆé€¢äººé…ï¼‰- å½“å‰çº§æ•°çš„çº¢æ¡ƒç‰Œ
            isJokerCard(card) {
                return card.suit === 'â™¥' && card.rank === this.jokerCard;
            }

            // è·å–ç‰Œé¢è®¡æ•°
            getRankCounts(cards) {
                const counts = {};
                cards.forEach(card => {
                    counts[card.rank] = (counts[card.rank] || 0) + 1;
                });
                return counts;
            }

            // è·å–ç‰Œå‹ï¼ˆä½¿ç”¨æ–°è§„åˆ™å¼•æ“ï¼‰
            getCardType(cards) {
                if (!cards || cards.length === 0) return null;

                // ä¼˜å…ˆä½¿ç”¨é«˜çº§è§„åˆ™å¼•æ“
                if (this.useAdvancedEngine && this.ruleEngine) {
                    try {
                        const result = this.ruleEngine.getCardType(cards);
                        if (result) return result;
                    } catch (error) {
                        console.warn('[é«˜çº§è§„åˆ™å¼•æ“] ç‰Œå‹è¯†åˆ«å¤±è´¥ï¼Œé™çº§åˆ°åŸºç¡€å¼•æ“:', error);
                    }
                }

                // é™çº§åˆ°åŸºç¡€è§„åˆ™å¼•æ“
                return this.getBasicCardType(cards);
            }

            // åŸºç¡€ç‰Œå‹è¯†åˆ«ï¼ˆé™çº§æ–¹æ¡ˆï¼‰
            getBasicCardType(cards) {
                const length = cards.length;

                // å•å¼ 
                if (length === 1) {
                    return { type: 'single', power: 10 + this.rules.getCardValue(cards[0].rank), cards: cards };
                }

                // å¯¹å­
                if (length === 2 && cards[0].rank === cards[1].rank) {
                    return { type: 'pair', power: 20 + this.rules.getCardValue(cards[0].rank), rank: cards[0].rank, cards: cards };
                }

                // ä¸‰å¼ 
                if (length === 3 && cards.every(card => card.rank === cards[0].rank)) {
                    return { type: 'three', power: 30 + this.rules.getCardValue(cards[0].rank), rank: cards[0].rank, cards: cards };
                }

                // ä¸‰å¸¦äºŒï¼ˆ5å¼ ï¼š3å¼ ç›¸åŒ+2å¼ ç›¸åŒï¼‰
                if (length === 5) {
                    const ranks = {};
                    cards.forEach(card => {
                        ranks[card.rank] = (ranks[card.rank] || 0) + 1;
                    });

                    const rankCounts = Object.values(ranks);
                    if (rankCounts.includes(3) && rankCounts.includes(2)) {
                        const tripleRank = Object.keys(ranks).find(rank => ranks[rank] === 3);
                        return {
                            type: 'triple_with_pair',
                            power: 50 + this.rules.getCardValue(tripleRank),
                            rank: tripleRank,
                            cards: cards
                        };
                    }
                }

                // ç‚¸å¼¹
                if (length >= 4 && cards.every(card => card.rank === cards[0].rank)) {
                    const power = 400 + this.rules.getCardValue(cards[0].rank) + (length - 4) * 100;
                    return { type: 'bomb', power: power, rank: cards[0].rank, cards: cards };
                }

                // å››ç‹ï¼ˆ4å¼ ç‹ç‰Œï¼‰- å®˜æ–¹è§„åˆ™ä¸­çš„æœ€å¤§ç‰Œå‹
                if (length === 4 && cards.every(card => card.suit === 'JOKER')) {
                    return { type: 'four_kings', power: 1000, cards: cards };
                }

                return null;
            }

            // æ¯”è¾ƒä¸¤ä¸ªç‰Œå‹çš„å¤§å°ï¼ˆä½¿ç”¨æ–°è§„åˆ™å¼•æ“ï¼‰
            compareCardTypes(lastPlay, currentPlay) {
                if (!lastPlay) return true; // é¦–å®¶å‡ºç‰Œï¼Œä»»æ„ç‰Œå‹éƒ½å¯ä»¥

                // ä¼˜å…ˆä½¿ç”¨é«˜çº§è§„åˆ™å¼•æ“
                if (this.useAdvancedEngine && this.ruleEngine) {
                    try {
                        const result = this.ruleEngine.compareCardTypes(currentPlay, lastPlay);
                        return result > 0;
                    } catch (error) {
                        console.warn('[é«˜çº§è§„åˆ™å¼•æ“] ç‰Œå‹æ¯”è¾ƒå¤±è´¥ï¼Œé™çº§åˆ°åŸºç¡€å¼•æ“:', error);
                    }
                }

                // é™çº§åˆ°åŸºç¡€æ¯”è¾ƒ
                return this.basicCompareCardTypes(lastPlay, currentPlay);
            }

            // åŸºç¡€ç‰Œå‹æ¯”è¾ƒï¼ˆé™çº§æ–¹æ¡ˆï¼‰
            basicCompareCardTypes(lastPlay, currentPlay) {
                const lastType = lastPlay.type;
                const currentType = currentPlay.type;

                // å››ç‹æœ€å¤§
                if (currentType === 'four_kings') return true;
                if (lastType === 'four_kings') return false;

                // ç‚¸å¼¹å¯ä»¥æ‰“ä»»ä½•æ™®é€šç‰Œå‹
                if (currentType === 'bomb' && lastType !== 'bomb' && lastType !== 'four_kings') return true;
                if (lastType === 'bomb' && currentType !== 'bomb') return false;

                // åŒç±»å‹æ¯”è¾ƒï¼ˆéƒ½æ˜¯æ™®é€šç‰Œå‹ï¼‰
                if (lastType === currentType) {
                    return currentPlay.power > lastPlay.power;
                }

                return false; // ä¸åŒç±»å‹ä¸èƒ½æ¯”è¾ƒ
            }

            // éªŒè¯å‡ºç‰Œæ˜¯å¦åˆæ³•ï¼ˆä½¿ç”¨æ–°è§„åˆ™å¼•æ“ï¼‰
            validatePlay(cards, lastPlay, playerHand) {
                try {
                    // ä¼˜å…ˆä½¿ç”¨é«˜çº§è§„åˆ™å¼•æ“
                    if (this.useAdvancedEngine && this.ruleEngine) {
                        try {
                            // è½¬æ¢lastPlayæ ¼å¼
                            let lastPlayCards = null;
                            if (lastPlay && lastPlay.cards) {
                                lastPlayCards = lastPlay.cards;
                            } else if (lastPlay && Array.isArray(lastPlay)) {
                                lastPlayCards = lastPlay;
                            }

                            const result = this.ruleEngine.validatePlay(cards, lastPlayCards, playerHand);
                            if (result.valid) {
                                return {
                                    valid: true,
                                    message: 'å‡ºç‰Œåˆæ³•',
                                    cardType: result.type || this.getCardType(cards),
                                    type: result.type ? result.type.type : 'unknown'
                                };
                            } else {
                                return {
                                    valid: false,
                                    message: result.message || 'å‡ºç‰Œä¸åˆæ³•'
                                };
                            }
                        } catch (error) {
                            console.warn('[é«˜çº§è§„åˆ™å¼•æ“] éªŒè¯å¤±è´¥ï¼Œé™çº§åˆ°åŸºç¡€å¼•æ“:', error);
                        }
                    }

                    // é™çº§åˆ°åŸºç¡€éªŒè¯
                    return this.basicValidatePlay(cards, lastPlay, playerHand);

                } catch (error) {
                    console.error('[å‡ºç‰ŒéªŒè¯é”™è¯¯]', error);
                    return {
                        valid: false,
                        message: 'éªŒè¯å‡ºé”™: ' + error.message
                    };
                }
            }

            // åŸºç¡€å‡ºç‰ŒéªŒè¯ï¼ˆé™çº§æ–¹æ¡ˆï¼‰
            basicValidatePlay(cards, lastPlay, playerHand) {
                // 1. æ£€æŸ¥ç‰Œæ˜¯å¦åœ¨æ‰‹ç‰Œä¸­
                if (!this.areCardsInHand(cards, playerHand)) {
                    return { valid: false, message: 'å‡ºçš„ç‰Œä¸åœ¨æ‰‹ç‰Œä¸­' };
                }

                // 2. æ£€æŸ¥ç‰Œå‹æ˜¯å¦æœ‰æ•ˆ
                const cardType = this.getCardType(cards);
                if (!cardType) {
                    return { valid: false, message: 'æ— æ•ˆçš„ç‰Œå‹' };
                }

                // 3. æ£€æŸ¥æ˜¯å¦èƒ½æ‰“è¿‡ä¸Šå®¶
                if (!this.compareCardTypes(lastPlay, cardType)) {
                    return { valid: false, message: 'å‡ºç‰Œä¸å¤Ÿå¤§' };
                }

                return { valid: true, message: 'å‡ºç‰Œåˆæ³•', cardType: cardType };
            }

            // æ£€æŸ¥ç‰Œæ˜¯å¦åœ¨æ‰‹ç‰Œä¸­
            areCardsInHand(cardsToPlay, playerHand) {
                const handCopy = [...playerHand];

                for (const card of cardsToPlay) {
                    const index = handCopy.findIndex(handCard =>
                        handCard.suit === card.suit && handCard.rank === card.rank
                    );
                    if (index === -1) return false;
                    handCopy.splice(index, 1);
                }

                return true;
            }
        }

        // å…¨å±€æ¸¸æˆå®ä¾‹
        let game;

        // å…¨å±€å‡½æ•°
        function playCards() {
            if (game) game.playCards();
        }

        function passTurn() {
            if (game) game.passTurn();
        }

        function showHint() {
            if (game) game.showHint();
        }

        function reportCards() {
            if (game) game.reportCards();
        }

        function showRecords() {
            if (game) game.showRecords();
        }

        function restartGame() {
            if (game) game.restartGame();
        }

        function showSettings() {
            if (game) game.showSettings();
        }

        // æ¨¡å—åŒ–åŠ è½½ç®¡ç†å™¨
        class ModuleLoader {
            constructor() {
                this.modules = new Map();
                this.loadProgress = 0;
                this.totalModules = 7;
                this.gameEngine = null;
                this.isDevMode = window.location.search.includes('dev=true');
            }

            // åŠ è½½è¿›åº¦æ›´æ–°
            updateProgress(moduleName, status, progress = null) {
                this.loadProgress = Math.min(100, this.loadProgress + (100 / this.totalModules));

                document.getElementById('loadingProgress').style.width = this.loadProgress + '%';
                document.getElementById('loadingStatus').textContent = `æ­£åœ¨åŠ è½½ ${moduleName}...`;

                if (this.isDevMode) {
                    this.updateModuleStatus(moduleName, status);
                }

                this.log(`[æ¨¡å—åŠ è½½] ${moduleName}: ${status}`);
            }

            // æ›´æ–°æ¨¡å—çŠ¶æ€æ˜¾ç¤º
            updateModuleStatus(moduleName, status) {
                const moduleId = `module-${moduleName.toLowerCase().replace('_', '-')}`;
                const element = document.getElementById(moduleId);
                if (element) {
                    element.className = `module-status ${status}`;
                    element.textContent = element.textContent.split(':')[0] + ': ' + status;
                }
            }

            // æ—¥å¿—è¾“å‡º
            log(message) {
                if (this.isDevMode) {
                    const console = document.getElementById('devConsole');
                    if (console) {
                        console.innerHTML += message + '<br>';
                        console.scrollTop = console.scrollHeight;
                    }
                }
                console.log(message);
            }

            // é”™è¯¯å¤„ç†
            handleError(error, moduleName) {
                this.log(`[é”™è¯¯] ${moduleName}: ${error.message}`);
                this.updateModuleStatus(moduleName, 'error');

                document.getElementById('errorText').textContent = `${moduleName} åŠ è½½å¤±è´¥: ${error.message}`;
                document.getElementById('errorMessage').classList.add('show');
            }

            // æ˜¾ç¤ºå¼€å‘æ¨¡å¼ä¿¡æ¯
            showDevInfo() {
                if (this.isDevMode) {
                    document.getElementById('moduleInfo').style.display = 'block';
                    document.getElementById('devConsole').classList.add('show');
                }
            }

            // ä¸»åŠ è½½å‡½æ•°
            async loadAllModules() {
                try {
                    this.showDevInfo();

                    // æ¨¡æ‹ŸåŠ è½½å„ç§æ¨¡å—
                    this.updateProgress('è§„åˆ™é…ç½®', 'loading');
                    setTimeout(() => this.updateProgress('è§„åˆ™é…ç½®', 'loaded'), 300);

                    this.updateProgress('æ¸¸æˆå¼•æ“', 'loading');
                    setTimeout(() => this.updateProgress('æ¸¸æˆå¼•æ“', 'loaded'), 300);

                    this.updateProgress('ç©å®¶ç®¡ç†', 'loading');
                    setTimeout(() => this.updateProgress('ç©å®¶ç®¡ç†', 'loaded'), 300);

                    this.updateProgress('ç•Œé¢ç»„ä»¶', 'loading');
                    setTimeout(() => this.updateProgress('ç•Œé¢ç»„ä»¶', 'loaded'), 300);

                    // 4. åˆå§‹åŒ–æ¸¸æˆ
                    await this.initializeGame();

                    // 5. éšè—åŠ è½½ç”»é¢ï¼Œæ˜¾ç¤ºæ¸¸æˆ
                    setTimeout(() => {
                        document.getElementById('loadingScreen').style.display = 'none';
                        document.getElementById('gameContainer').classList.add('loaded');
                    }, 500);

                    this.log('[ç³»ç»Ÿ] æ‰€æœ‰æ¨¡å—åŠ è½½å®Œæˆï¼Œæ¸¸æˆåˆå§‹åŒ–æˆåŠŸ');

                } catch (error) {
                    this.handleError(error, 'æ¨¡å—åŠ è½½å™¨');
                }
            }

            // åˆå§‹åŒ–æ¸¸æˆ
            async initializeGame() {
                try {
                    // åˆ›å»ºæ¸¸æˆå®ä¾‹
                    game = new GuandanGame();

                    this.log('[æ¸¸æˆå¼•æ“] åˆå§‹åŒ–å®Œæˆ');

                } catch (error) {
                    this.handleError(error, 'æ¸¸æˆåˆå§‹åŒ–');
                    throw error;
                }
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåå¼€å§‹åŠ è½½æ¨¡å—
        document.addEventListener('DOMContentLoaded', () => {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹æ¨¡å—åŠ è½½æµç¨‹');
            const loader = new ModuleLoader();

            // å»¶è¿Ÿä¸€ç‚¹æ—¶é—´ç¡®ä¿DOMå®Œå…¨å‡†å¤‡å¥½
            setTimeout(() => {
                loader.loadAllModules();
            }, 100);
        });

        // å…¨å±€é”™è¯¯å¤„ç†
        window.addEventListener('error', (event) => {
            console.error('[å…¨å±€é”™è¯¯]', event.error);
        });

        // æ¨¡å—åŒ–å¼€å‘è°ƒè¯•å·¥å…·
        if (window.location.search.includes('dev=true')) {
            window.gameDebug = {
                getGameEngine: () => window.game,
                reloadModules: () => location.reload(),
                showModuleInfo: () => {
                    const info = document.getElementById('moduleInfo');
                    info.style.display = info.style.display === 'none' ? 'block' : 'none';
                }
            };

            // æ·»åŠ å¼€å‘å¿«æ·é”®
            document.addEventListener('keydown', (event) => {
                if (event.ctrlKey && event.shiftKey) {
                    switch(event.key) {
                        case 'D':
                            gameDebug.showModuleInfo();
                            break;
                        case 'R':
                            gameDebug.reloadModules();
                            break;
                    }
                }
            });
        }
    </script>
</body>
</html>
